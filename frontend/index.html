<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/pulse/bootstrap.min.css">
    <link rel="stylesheet" href="node_modules/bootstrap-icons/font/bootstrap-icons.css">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    <title>TTU Group Survey</title>
</head>

<body>

    <!-- Main container for SPA -->
    <!-- <div id="app"></div> -->

    <!-- Login and Registration forms container -->
    <div class="d-flex align-items-center justify-content-center min-vh-100">
        <div class="container">
            <div class="row justify-content-center">
                <!-- Login Form -->
                <div class="col-12 col-md-6 col-lg-4">
                    <form class="card shadow-lg" id="frmLogin">
                        <div class="card-body p-4">
                            <h2 class="text-center mb-3">TTU Group Survey Login</h2>
                            <h5 class="text-center mb-4">Login below</h5>

                            <!-- Email -->
                            <div class="mb-3">
                                <label for="strUsername" class="form-label d-flex align-items-start">Email</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                                    <input id="strUsername" class="form-control" type="email" placeholder="JohnDoe@tntech.edu" aria-label="input for user Email">
                                </div>
                            </div>
                            
                            <!-- Password -->
                            <div class="mb-3">
                                <label for="strPassword" class="form-label">Password</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                                    <input id="strPassword" class="form-control" type="password" placeholder="Password" aria-label="Password">
                                </div>
                                <div class="text-right">
                                    <button type="button" class="btn btn-link" id="btnForgot">Forgot Password</button>
                                </div>
                            </div>

                            <button type="button" class="btn btn-primary col-12 mt-2" id="btnLogin">Login</button>
                            <button type="button" class="btn btn-link col-12 mt-2" id="btnSwap">Don't have an account? Register here</button>
                        </div>
                    </form>
                </div>

                <!-- Registration Form -->
                <div class="col-12 col-md-8 col-lg-6">
                    <form class="card shadow-lg" id="frmRegister" style="display:none;">
                        <div class="card-body p-4">
                            <h2 class="text-center mb-3">TTU Group Survey Registration</h2>
                            <h5 class="text-center mb-4">Register below</h5>
                    
                            <!-- First Name -->
                            <div class="mb-3">
                                <label for="strFirstName" class="form-label">First Name</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                                    <input id="strFirstName" class="form-control" type="text" placeholder="John" aria-label="First Name">
                                </div>
                            </div>
                    
                            <!-- Middle Name -->
                            <div class="mb-3">
                                <label for="strMiddleName" class="form-label">Middle Name</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                                    <input id="strMiddleName" class="form-control" type="text" placeholder="Optional" aria-label="Middle Name">
                                </div>
                            </div>
                    
                            <!-- Last Name -->
                            <div class="mb-3">
                                <label for="strLastName" class="form-label">Last Name</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                                    <input id="strLastName" class="form-control" type="text" placeholder="Doe" aria-label="Last Name">
                                </div>
                            </div>
                    
                            <!-- Email -->
                            <div class="mb-3">
                                <label for="strEmail" class="form-label">Email</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                                    <input id="strEmail" class="form-control" type="email" placeholder="JohnDoe@tntech.edu" aria-label="Email">
                                </div>
                            </div>
                            
                            <!-- Role -->
                            <div class="mb-3">
                                <label for="strRole" class="form-label">Role</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                                    <select id="strRole" class="form-select" aria-label="Input for role of user">
                                        <option selected disabled value="">Select Role</option>
                                        <option value="Student">Student</option>
                                        <option value="Faculty">Faculty</option>
                                    </select>
                                </div>
                            </div>
                    
                            <!-- Password -->
                            <div class="mb-3">
                                <label for="strNewPassword" class="form-label">Password</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                                    <input id="strNewPassword" class="form-control" type="password" placeholder="Password" aria-label="Password">
                                </div>
                            </div>
                    
                            <!-- Confirm Password -->
                            <div class="mb-3">
                                <label for="strConfirmPassword" class="form-label">Confirm Password</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-lock-fill"></i></span>
                                    <input id="strConfirmPassword" class="form-control" type="password" placeholder="Confirm Password" aria-label="Confirm Password">
                                </div>
                            </div>
                    
                            <!-- Register Button -->
                            <button type="button" class="btn btn-primary col-12 mt-3" id="btnRegister">Register</button>
                    
                            <!-- Back to Login Button -->
                            <button type="button" class="btn btn-link col-12 mt-2 text-center" id="btnBack">Already have an account? Login here</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Dashboard -->
    <div class="position-absolute top-0 start-0 w-100">
        <form id="frmStudentDash" style="display:none;">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark w-100">
                <div class="container">
                    <a class="navbar-brand" href="#">TTU Group Survey</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">Surveys</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Account
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <li><a class="dropdown-item" href="#">Profile</a></li>
                                    <li><a class="dropdown-item" href="#">Settings</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item" href="#" id="btnLogout">Logout</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <div class="container mt-4">
                <h1>Student Dashboard</h1>
                <p>Welcome to your student dashboard. Here you can view and complete surveys.</p>
                
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Available Surveys</h5>
                                <p class="card-text">You have 3 surveys waiting for your response.</p>
                                <button class="btn btn-primary" id="btnViewAvaSurveys">View Surveys</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Completed Surveys</h5>
                                <p class="card-text">You have completed 5 surveys.</p>
                                <a href="#" class="btn btn-secondary">View History</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Groups</h5>
                                <p class="card-text">You are a member of 2 groups.</p>
                                <a href="#" class="btn btn-info">View Groups</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- View Surveys Modal -->
            <div class="modal fade" id="viewSurveysModal" tabindex="-1" aria-labelledby="viewSurveysModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="viewSurveysModalLabel">Available Surveys</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="surveysList" class="list-group">
                                <!-- Surveys will be loaded here dynamically -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Survey Detail Modal -->
            <div class="modal fade" id="surveyDetailModal" tabindex="-1" aria-labelledby="surveyDetailModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="surveyDetailModalLabel">Survey Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="surveyDetailContent">
                                <!-- Survey details will be loaded here dynamically -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="btnCompleteSurvey">Complete Survey</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Complete Survey Modal -->
            <div class="modal fade" id="completeSurveyModal" tabindex="-1" aria-labelledby="completeSurveyModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="completeSurveyModalLabel">Complete Survey</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="surveyResponseForm">
                                <div class="mb-3">
                                    <label for="studentGroupMemberSelect" class="form-label">Select Group Member</label>
                                    <select class="form-select" id="studentGroupMemberSelect" required>
                                        <option value="">Choose a group member...</option>
                                    </select>
                                </div>
                                <div id="surveyFieldsContainer">
                                    <!-- Survey fields will be loaded here dynamically -->
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary" id="btnSubmitSurvey">Submit Response</button>
                            <button type="button" class="btn btn-success" id="btnCompleteAnother">Complete Another</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Group Responses Modal -->
            <div class="modal fade" id="groupResponsesModal" tabindex="-1" aria-labelledby="groupResponsesModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="groupResponsesModalLabel">Group Responses</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="groupResponsesContent">
                                <!-- Group responses will be loaded here dynamically -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Manage Groups Modal -->
            <div class="modal fade" id="manageGroupsModal" tabindex="-1" aria-labelledby="manageGroupsModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="manageGroupsModalLabel">Manage Groups</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="d-flex justify-content-end mb-3">
                                <button type="button" class="btn btn-success" id="btnAddNewGroup">
                                    <i class="bi bi-plus-circle"></i> Add New Group
                                </button>
                            </div>
                            <div id="groupsListContainer" class="list-group">
                                <!-- Groups will be loaded here dynamically -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Student Groups Modal -->
            <div class="modal fade" id="studentGroupsModal" tabindex="-1" aria-labelledby="studentGroupsModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="studentGroupsModalLabel">Your Groups</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div id="studentGroupsList" class="list-group">
                                <!-- Groups will be loaded here dynamically -->
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Add custom CSS for modal z-index -->
            <style>
                .modal-backdrop {
                    z-index: 1050;
                }
                #createSurveyModal {
                    z-index: 1055 !important;
                }
                #createSurveyModal .modal-dialog {
                    z-index: 1056 !important;
                }
                #addFieldModal {
                    z-index: 1060 !important;
                }
                #addFieldModal .modal-dialog {
                    z-index: 1061 !important;
                }
                #addGroupModal {
                    z-index: 1060 !important;
                }
                #addGroupModal .modal-dialog {
                    z-index: 1061 !important;
                }
                #manageGroupsModal {
                    z-index: 1060 !important;
                }
                #manageGroupsModal .modal-dialog {
                    z-index: 1061 !important;
                }
                .blur-background {
                    filter: blur(5px);
                    -webkit-filter: blur(5px);
                    transition: filter 0.3s ease;
                }
                .blur-background .modal-content {
                    filter: none;
                    -webkit-filter: none;
                }
            </style>
        </form>
    </div>
    <!-- Faculty Dashboard -->
    <div class="position-absolute top-0 start-0 w-100">
        <form id="frmFacultyDash" style="display:none;">
            <nav class="navbar navbar-expand-lg navbar-dark bg-dark">  
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">TTU Group Survey</a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="#">Home</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" id="btnCreateSurvey">Create Survey</a>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link btn btn-link" type="button" id="btnManageGroupsNav">Manage Groups</button>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Account
                                </a>
                                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <li><a class="dropdown-item" href="#">Profile</a></li>
                                    <li><a class="dropdown-item" href="#">Settings</a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li><a class="dropdown-item logout-link" href="#" onclick="logout()">Logout</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <div class="container mt-4">
                <h1>Faculty Dashboard</h1>
                <p>Welcome to your faculty dashboard. Here you can create and manage surveys.</p>
                
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Create Survey</h5>
                                <p class="card-text">Create a new survey for your students.</p>
                                <button type="button" class="btn btn-primary" id="btnCreateSurveyCard">Create Survey</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">View Surveys</h5>
                                <p class="card-text">View and manage your existing surveys.</p>
                                <button type="button" class="btn btn-success" id="btnViewSurveys">View Surveys</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Manage Groups</h5>
                                <p class="card-text">Create and manage student groups.</p>
                                <button type="button" class="btn btn-info" id="btnManageGroupsCard">Manage Groups</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Create Survey Modal -->
    <div class="modal fade" id="createSurveyModal" tabindex="-1" aria-labelledby="createSurveyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createSurveyModalLabel">Create New Survey</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="surveyForm">
                        <div class="mb-3">
                            <label for="surveyTitle" class="form-label">Survey Title</label>
                            <input type="text" class="form-control" id="surveyTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="surveyDescription" class="form-label">Survey Description</label>
                            <textarea class="form-control" id="surveyDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <h5>Survey Fields</h5>
                            <div id="surveyFields" class="mb-3">
                                <!-- Fields will be added here dynamically -->
                            </div>
                            <button type="button" class="btn btn-success" id="btnAddField">
                                <i class="bi bi-plus-circle"></i> Add Field
                            </button>
                        </div>
                        
                        <div class="mb-3">
                            <h5>Assign to Groups</h5>
                            <div id="groupsList" class="mb-3">
                                <!-- Groups will be added here dynamically -->
                            </div>
                            <button type="button" class="btn btn-success" id="btnAddGroup">
                                <i class="bi bi-plus-circle"></i> Add Group
                            </button>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnSaveSurvey">Save Survey</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Field Modal -->
    <div class="modal fade" id="addFieldModal" tabindex="-1" aria-labelledby="addFieldModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addFieldModalLabel">Add Survey Field</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="fieldForm">
                        <div class="mb-3">
                            <label for="fieldLabel" class="form-label">Field Label</label>
                            <input type="text" class="form-control" id="fieldLabel" required>
                        </div>
                        <div class="mb-3">
                            <label for="fieldType" class="form-label">Field Type</label>
                            <select class="form-select" id="fieldType" required>
                                <option value="text">Text Box</option>
                                <option value="textarea">Text Area</option>
                                <option value="select">Dropdown</option>
                                <option value="multiselect">Multiple Select</option>
                                <option value="radio">Radio Buttons</option>
                                <option value="checkbox">Checkboxes</option>
                                <option value="date">Date</option>
                                <option value="number">Number</option>
                            </select>
                        </div>
                        <div class="mb-3" id="optionsContainer" style="display: none;">
                            <label for="fieldOptions" class="form-label">Options (one per line)</label>
                            <textarea class="form-control" id="fieldOptions" rows="3"></textarea>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="fieldRequired">
                            <label class="form-check-label" for="fieldRequired">
                                Required field
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnSaveField">Add Field</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Group Modal -->
    <div class="modal fade" id="addGroupModal" tabindex="-1" aria-labelledby="addGroupModalLabel" aria-hidden="true" style="z-index: 1060;">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addGroupModalLabel">Add Group</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="groupForm">
                        <div class="mb-3">
                            <label for="groupName" class="form-label">Group Name</label>
                            <input type="text" class="form-control" id="groupName" required>
                        </div>
                        <div class="mb-3">
                            <label for="groupMembers" class="form-label">Group Members (one per line)</label>
                            <textarea class="form-control" id="groupMembers" rows="5" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="btnSaveGroup">Add Group</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- View Surveys Modal -->
    <div class="modal fade" id="viewSurveysModal" tabindex="-1" aria-labelledby="viewSurveysModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewSurveysModalLabel">Your Surveys</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="surveysList" class="list-group">
                        <!-- Surveys will be loaded here dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Survey Detail Modal -->
    <div class="modal fade" id="surveyDetailModal" tabindex="-1" aria-labelledby="surveyDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="surveyDetailModalLabel">Survey Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="surveyDetailContent">
                        <!-- Survey details will be loaded here dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnCompleteSurvey">Complete Survey</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Complete Survey Modal -->
    <div class="modal fade" id="completeSurveyModal" tabindex="-1" aria-labelledby="completeSurveyModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="completeSurveyModalLabel">Complete Survey</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="surveyResponseForm">
                        <div class="mb-3">
                            <label for="facultyGroupMemberSelect" class="form-label">Select Group Member</label>
                            <select class="form-select" id="facultyGroupMemberSelect" required>
                                <option value="">Choose a group member...</option>
                            </select>
                        </div>
                        <div id="surveyFieldsContainer">
                            <!-- Survey fields will be loaded here dynamically -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnSubmitSurvey">Submit Response</button>
                    <button type="button" class="btn btn-success" id="btnCompleteAnother">Complete Another</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Group Responses Modal -->
    <div class="modal fade" id="groupResponsesModal" tabindex="-1" aria-labelledby="groupResponsesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="groupResponsesModalLabel">Group Responses</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="groupResponsesContent">
                        <!-- Group responses will be loaded here dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Manage Groups Modal -->
    <div class="modal fade" id="manageGroupsModal" tabindex="-1" aria-labelledby="manageGroupsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="manageGroupsModalLabel">Manage Groups</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-end mb-3">
                        <button type="button" class="btn btn-success" id="btnAddNewGroup">
                            <i class="bi bi-plus-circle"></i> Add New Group
                        </button>
                    </div>
                    <div id="groupsListContainer" class="list-group">
                        <!-- Groups will be loaded here dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Student Groups Modal -->
    <div class="modal fade" id="studentGroupsModal" tabindex="-1" aria-labelledby="studentGroupsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="studentGroupsModalLabel">Your Groups</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="studentGroupsList" class="list-group">
                        <!-- Groups will be loaded here dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="profileModalLabel">Faculty Profile</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Profile Information -->
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Profile Information</h5>
                                    <div class="text-center mb-3">
                                        <i class="bi bi-person-circle" style="font-size: 4rem;"></i>
                                    </div>
                                    <div id="profileInfo">
                                        <p><strong>Name:</strong> <span id="profileName"></span></p>
                                        <p><strong>Email:</strong> <span id="profileEmail"></span></p>
                                        <p><strong>Department:</strong> <span id="profileDepartment"></span></p>
                                        <p><strong>Classes Teaching:</strong> <span id="profileClasses"></span></p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Teaching Schedule -->
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Teaching Schedule</h5>
                                    <div id="teachingSchedule">
                                        <!-- Teaching schedule will be populated dynamically -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Weekly Schedule -->
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-body">
                                    <h5 class="card-title">Weekly Schedule</h5>
                                    <div class="table-responsive">
                                        <table class="table table-bordered">
                                            <thead class="table-light">
                                                <tr>
                                                    <th style="width: 100px;">Time</th>
                                                    <th>Monday</th>
                                                    <th>Tuesday</th>
                                                    <th>Wednesday</th>
                                                    <th>Thursday</th>
                                                    <th>Friday</th>
                                                </tr>
                                            </thead>
                                            <tbody id="scheduleTable">
                                                <!-- Schedule will be populated dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="mt-3">
                                        <small class="text-muted">
                                            <i class="bi bi-info-circle"></i> 
                                            Green cells indicate teaching hours, yellow cells indicate office hours, and white cells indicate available time.
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="btnEditProfile">Edit Profile</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add custom CSS for modal z-index -->
    <style>
        .modal-backdrop {
            z-index: 1050;
        }
        #createSurveyModal {
            z-index: 1055 !important;
        }
        #createSurveyModal .modal-dialog {
            z-index: 1056 !important;
        }
        #addFieldModal {
            z-index: 1060 !important;
        }
        #addFieldModal .modal-dialog {
            z-index: 1061 !important;
        }
        #addGroupModal {
            z-index: 1060 !important;
        }
        #addGroupModal .modal-dialog {
            z-index: 1061 !important;
        }
        #manageGroupsModal {
            z-index: 1060 !important;
        }
        #manageGroupsModal .modal-dialog {
            z-index: 1061 !important;
        }
        .blur-background {
            filter: blur(5px);
            -webkit-filter: blur(5px);
            transition: filter 0.3s ease;
        }
        .blur-background .modal-content {
            filter: none;
            -webkit-filter: none;
        }
        .schedule-cell {
            min-height: 60px;
            padding: 5px;
        }
        .teaching-hour {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .office-hour {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
        }
        .available-hour {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
        }
        .teaching-schedule-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
        }
    </style>
</body>
 <!-- Bootstrap JS -->
 <script type="module" src="node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    
 <!-- SweetAlert2 JS -->
 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 
 <!-- Main application script -->
 <script>
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize Bootstrap modals
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            new bootstrap.Modal(modal);
        });

        // Validation for Login Form
        const btnLogin = document.querySelector("#btnLogin");
        if (btnLogin) {
            btnLogin.addEventListener("click", handleLogin);
        }

        // Validation for Registration Form
        const btnRegister = document.querySelector("#btnRegister");
        if (btnRegister) {
            btnRegister.addEventListener("click", handleRegister);
        }

        // Form switching
        const btnSwap = document.getElementById('btnSwap');
        if (btnSwap) {
            btnSwap.addEventListener('click', function(){
                document.getElementById('frmLogin').style.display = 'none';
                document.getElementById('frmRegister').style.display = 'block';
                // Scroll to the top of the page
                window.scrollTo(0, 0);
            });
        }

        const btnBack = document.getElementById('btnBack');
        if (btnBack) {
            btnBack.addEventListener('click', function(){
                document.getElementById('frmLogin').style.display = 'block';
                document.getElementById('frmRegister').style.display = 'none';
                // Scroll to the top of the page
                window.scrollTo(0, 0);
            });
        }

        // Forgot Password
        const btnForgot = document.getElementById('btnForgot');
        if (btnForgot) {
            btnForgot.addEventListener('click', function(){
                Swal.fire({
                    title: 'Forgot Password',
                    text: 'Please contact Professor for password reset',
                    icon: 'info',
                    confirmButtonText: 'OK'
                });
            });
        }

        // View Available Surveys Modal
        const btnViewAvaSurveys = document.getElementById('btnViewAvaSurveys');
        if (btnViewAvaSurveys) {
            btnViewAvaSurveys.addEventListener('click', function () {
                // Check if user is logged in
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please login first',
                        icon: 'error'
                    });
                    return;
                }

                const surveysList = document.getElementById('surveysList');
                if (surveysList) {
                    surveysList.innerHTML = ''; // Clear existing content

                    // Retrieve surveys from localStorage
                    const surveys = JSON.parse(localStorage.getItem('surveys')) || [];

                    if (surveys.length === 0) {
                        surveysList.innerHTML = '<p class="text-center">No surveys available.</p>';
                    } else {
                        surveys.forEach((survey, index) => {
                            const surveyItem = document.createElement('div');
                            surveyItem.className = 'list-group-item';
                            surveyItem.innerHTML = `
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h4 class="mb-2">${survey.title}</h4>
                                        <p class="mb-1">${survey.description}</p>
                                        <p class="mb-0"><strong>Groups:</strong> ${survey.groups.join(', ') || 'None'}</p>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary" onclick="viewSurveyDetails(${index})">View Survey</button>
                                    </div>
                                </div>
                            `;
                            surveysList.appendChild(surveyItem);
                        });
                    }
                }

                // Show the modal
                const modal = document.getElementById('viewSurveysModal');
                if (modal) {
                    const myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }
            });
        }

        // View Active Surveys Modal
        const btnViewActSurveys = document.getElementById('btnViewActSurveys');
        if (btnViewActSurveys) {
            btnViewActSurveys.addEventListener('click', function() {
                const modal = document.getElementById('viewSurveysModal');
                if (modal) {
                    var myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }
            });
        }

        // Create Survey Modal
        const btnCreateSurvey = document.getElementById('btnCreateSurvey');
        if (btnCreateSurvey) {
            btnCreateSurvey.addEventListener('click', function() {
                const modal = document.getElementById('createSurveyModal');
                if (modal) {
                    var myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }
            });
        }

        // Create Survey Card Button
        const btnCreateSurveyCard = document.getElementById('btnCreateSurveyCard');
        if (btnCreateSurveyCard) {
            btnCreateSurveyCard.addEventListener('click', function() {
                const modal = document.getElementById('createSurveyModal');
                if (modal) {
                    var myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }
            });
        }

        // Logout button
        const btnLogout = document.querySelectorAll('#btnLogout');
        if (btnLogout) {
            btnLogout.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    logout();
                });
            });
        }

        // Add Field Button
        const btnAddField = document.getElementById('btnAddField');
        if (btnAddField) {
            btnAddField.addEventListener('click', function() {
                const modal = document.getElementById('addFieldModal');
                const createSurveyModal = document.getElementById('createSurveyModal');
                if (modal) {
                    // Add blur class to create survey modal
                    if (createSurveyModal) {
                        createSurveyModal.classList.add('blur-background');
                    }
                    var myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }
            });
        }

        // Add event listener for when the Add Field modal is hidden
        const addFieldModal = document.getElementById('addFieldModal');
        if (addFieldModal) {
            addFieldModal.addEventListener('hidden.bs.modal', function () {
                const createSurveyModal = document.getElementById('createSurveyModal');
                if (createSurveyModal) {
                    createSurveyModal.classList.remove('blur-background');
                }
            });
        }

        // Field Type Change Handler
        const fieldType = document.getElementById('fieldType');
        if (fieldType) {
            fieldType.addEventListener('change', function() {
                const optionsContainer = document.getElementById('optionsContainer');
                if (optionsContainer) {
                    const showOptions = ['select', 'multiselect', 'radio', 'checkbox'].includes(this.value);
                    optionsContainer.style.display = showOptions ? 'block' : 'none';
                }
            });
        }

        // Save Field Button
        const btnSaveField = document.getElementById('btnSaveField');
        if (btnSaveField) {
            btnSaveField.addEventListener('click', function() {
                const fieldLabel = document.getElementById('fieldLabel').value;
                const fieldType = document.getElementById('fieldType').value;
                const fieldRequired = document.getElementById('fieldRequired').checked;
                let fieldOptions = [];

                if (['select', 'multiselect', 'radio', 'checkbox'].includes(fieldType)) {
                    fieldOptions = document.getElementById('fieldOptions').value.split('\n').filter(option => option.trim() !== '');
                }

                if (!fieldLabel) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please enter a field label',
                        icon: 'error'
                    });
                    return;
                }

                // Create the field HTML
                const fieldHTML = createFieldHTML(fieldLabel, fieldType, fieldRequired, fieldOptions);
                
                // Add the field to the survey fields container
                const surveyFields = document.getElementById('surveyFields');
                if (surveyFields) {
                    surveyFields.appendChild(fieldHTML);
                }

                // Close the modal
                const modal = document.getElementById('addFieldModal');
                if (modal) {
                    var myModal = bootstrap.Modal.getInstance(modal);
                    myModal.hide();
                }

                // Reset the form
                document.getElementById('fieldForm').reset();
                document.getElementById('optionsContainer').style.display = 'none';
            });
        }

        // Helper function to create field HTML
        function createFieldHTML(label, type, required, options) {
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'mb-3 p-3 border rounded';
            
            let fieldHTML = `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="mb-0">${label} (${type}) ${required ? '<span class="text-danger">*</span>' : ''}</h6>
                    <button type="button" class="btn btn-sm btn-danger" onclick="this.parentElement.parentElement.remove()">
                        <i class="bi bi-trash"></i>
                    </button>
                </div>
            `;

            switch(type) {
                case 'text':
                    fieldHTML += `<input type="text" class="form-control" ${required ? 'required' : ''}>`;
                    break;
                case 'textarea':
                    fieldHTML += `<textarea class="form-control" ${required ? 'required' : ''}></textarea>`;
                    break;
                case 'select':
                    fieldHTML += `<select class="form-select" ${required ? 'required' : ''}>
                        <option value="">Select an option</option>
                        ${options.map(option => `<option value="${option}">${option}</option>`).join('')}
                    </select>`;
                    break;
                case 'multiselect':
                    fieldHTML += `<select class="form-select" multiple ${required ? 'required' : ''}>
                        ${options.map(option => `<option value="${option}">${option}</option>`).join('')}
                    </select>`;
                    break;
                case 'radio':
                    fieldHTML += options.map(option => `
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="${label}" value="${option}" ${required ? 'required' : ''}>
                            <label class="form-check-label">${option}</label>
                        </div>
                    `).join('');
                    break;
                case 'checkbox':
                    fieldHTML += options.map(option => `
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="${option}">
                            <label class="form-check-label">${option}</label>
                        </div>
                    `).join('');
                    break;
                case 'date':
                    fieldHTML += `<input type="date" class="form-control" ${required ? 'required' : ''}>`;
                    break;
                case 'number':
                    fieldHTML += `<input type="number" class="form-control" ${required ? 'required' : ''}>`;
                    break;
            }

            fieldDiv.innerHTML = fieldHTML;
            return fieldDiv;
        }

        // Add Group Button in Create Survey Modal
        const btnAddGroup = document.getElementById('btnAddGroup');
        if (btnAddGroup) {
            btnAddGroup.addEventListener('click', function() {
                const modal = document.getElementById('addGroupModal');
                const createSurveyModal = document.getElementById('createSurveyModal');
                if (modal) {
                    // Add blur class to create survey modal
                    if (createSurveyModal) {
                        createSurveyModal.classList.add('blur-background');
                    }
                    var myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }
            });
        }

        // Add event listener for Manage Groups Card Button
        const btnManageGroupsCard = document.getElementById('btnManageGroupsCard');
        if (btnManageGroupsCard) {
            console.log('Manage Groups card button found');
            btnManageGroupsCard.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Manage Groups card button clicked');
                
                // Check if user is logged in
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    console.log('No user logged in');
                    Swal.fire({
                        title: 'Error',
                        text: 'Please login first',
                        icon: 'error'
                    });
                    return;
                }
                console.log('User logged in:', currentUser);

                // Load existing groups
                const groupsListContainer = document.getElementById('groupsListContainer');
                if (groupsListContainer) {
                    console.log('Groups list container found');
                    groupsListContainer.innerHTML = ''; // Clear existing content

                    // Retrieve groups from localStorage
                    const groups = JSON.parse(localStorage.getItem('groups')) || [];
                    console.log('Retrieved groups:', groups);

                    if (groups.length === 0) {
                        groupsListContainer.innerHTML = '<p class="text-center">No groups available.</p>';
                    } else {
                        groups.forEach((group, index) => {
                            const groupItem = document.createElement('div');
                            groupItem.className = 'list-group-item';
                            groupItem.innerHTML = `
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5>${group.name}</h5>
                                        <p><strong>Members:</strong> ${group.members.join(', ')}</p>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary" onclick="editGroup(${index})">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteGroup(${index})">Delete</button>
                                    </div>
                                </div>
                            `;
                            groupsListContainer.appendChild(groupItem);
                        });
                    }
                } else {
                    console.log('Groups list container not found');
                }

                // Show the modal
                const manageGroupsModal = document.getElementById('manageGroupsModal');
                if (manageGroupsModal) {
                    console.log('Manage groups modal found');
                    try {
                        const modal = new bootstrap.Modal(manageGroupsModal);
                        modal.show();
                        console.log('Modal shown successfully');
                    } catch (error) {
                        console.error('Error showing modal:', error);
                    }
                } else {
                    console.log('Manage groups modal not found');
                }
            });
        } else {
            console.log('Manage Groups card button not found');
        }

        // Save Survey Button
        const btnSaveSurvey = document.getElementById('btnSaveSurvey');
        if (btnSaveSurvey) {
            btnSaveSurvey.addEventListener('click', function () {
                const surveyTitle = document.getElementById('surveyTitle').value.trim();
                const surveyDescription = document.getElementById('surveyDescription').value.trim();
                const surveyFields = document.getElementById('surveyFields').innerHTML; // Save the fields as HTML
                const assignedGroups = Array.from(document.querySelectorAll('#groupsList .member-item')).map(group => group.textContent.trim());

                if (!surveyTitle) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please enter a survey title',
                        icon: 'error'
                    });
                    return;
                }

                // Create survey object
                const survey = {
                    title: surveyTitle,
                    description: surveyDescription,
                    fields: surveyFields,
                    groups: assignedGroups,
                    createdAt: new Date().toISOString()
                };

                // Save survey to localStorage
                let surveys = JSON.parse(localStorage.getItem('surveys')) || [];
                surveys.push(survey);
                localStorage.setItem('surveys', JSON.stringify(surveys));

                // Update the active survey count
                const activeSurveyCount = document.getElementById('activeSurveyCount');
                if (activeSurveyCount) {
                    activeSurveyCount.textContent = surveys.length;
                }

                // Show success message
                Swal.fire({
                    title: 'Success',
                    text: 'Survey saved successfully!',
                    icon: 'success'
                });

                // Reset the form and close the modal
                document.getElementById('surveyForm').reset();
                document.getElementById('surveyFields').innerHTML = '';
                document.getElementById('groupsList').innerHTML = '';

                const modal = document.getElementById('createSurveyModal');
                if (modal) {
                    const myModal = bootstrap.Modal.getInstance(modal);
                    myModal.hide();
                }
            });
        }

        // Add delete survey function
        function deleteSurvey(index) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Get current surveys
                    let surveys = JSON.parse(localStorage.getItem('surveys')) || [];
                    
                    // Remove the survey at the specified index
                    surveys.splice(index, 1);
                    
                    // Save updated surveys
                    localStorage.setItem('surveys', JSON.stringify(surveys));
                    
                    // Update the active survey count
                    const activeSurveyCount = document.getElementById('activeSurveyCount');
                    if (activeSurveyCount) {
                        activeSurveyCount.textContent = surveys.length;
                    }
                    
                    // Show success message
                    Swal.fire(
                        'Deleted!',
                        'Your survey has been deleted.',
                        'success'
                    );
                    
                    // Refresh the surveys list
                    const surveysList = document.getElementById('surveysList');
                    if (surveysList) {
                        surveysList.innerHTML = ''; // Clear existing content
                        
                        if (surveys.length === 0) {
                            surveysList.innerHTML = '<p class="text-center">No surveys available.</p>';
                        } else {
                            surveys.forEach((survey, newIndex) => {
                                const surveyItem = document.createElement('div');
                                surveyItem.className = 'list-group-item';
                                surveyItem.innerHTML = `
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h4 class="mb-2">${survey.title}</h4>
                                            <p class="mb-1">${survey.description}</p>
                                            <p class="mb-0"><strong>Groups:</strong> ${survey.groups.join(', ') || 'None'}</p>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary" onclick="viewSurveyDetails(${newIndex})">View Survey</button>
                                        </div>
                                    </div>
                                `;
                                surveysList.appendChild(surveyItem);
                            });
                        }
                    }
                }
            });
        }

        // View Groups Button in Student Dashboard
        const btnViewGroups = document.querySelector('#frmStudentDash .btn-info');
        if (btnViewGroups) {
            btnViewGroups.addEventListener('click', async function() {
                // Get current user
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please login first',
                        icon: 'error'
                    });
                    return;
                }

                try {
                    // Fetch student's groups
                    const response = await fetch(`http://localhost:8000/student-groups?email=${currentUser.email}`);
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.error || 'Failed to fetch groups');
                    }

                    // Update groups list
                    const groupsList = document.getElementById('studentGroupsList');
                    if (groupsList) {
                        groupsList.innerHTML = ''; // Clear existing content

                        if (data.groups.length === 0) {
                            groupsList.innerHTML = '<p class="text-center">You are not a member of any groups.</p>';
                        } else {
                            data.groups.forEach(group => {
                                const groupItem = document.createElement('div');
                                groupItem.className = 'list-group-item';
                                groupItem.innerHTML = `
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5>${group.name}</h5>
                                            <p><strong>Members:</strong> ${group.members.join(', ')}</p>
                                        </div>
                                    </div>
                                `;
                                groupsList.appendChild(groupItem);
                            });
                        }
                    }

                    // Show the modal
                    const modal = document.getElementById('studentGroupsModal');
                    if (modal) {
                        const myModal = new bootstrap.Modal(modal);
                        myModal.show();
                    }
                } catch (error) {
                    console.error('Error fetching groups:', error);
                    Swal.fire({
                        title: 'Error',
                        text: 'Failed to load groups. Please try again.',
                        icon: 'error'
                    });
                }
            });
        }

        function viewSurveyDetails(index) {
            const surveys = JSON.parse(localStorage.getItem('surveys')) || [];
            const survey = surveys[index];

            if (survey) {
                const surveyDetailContent = document.getElementById('surveyDetailContent');
                if (surveyDetailContent) {
                    surveyDetailContent.innerHTML = `
                        <h5>${survey.title}</h5>
                        <p>${survey.description}</p>
                        <h6>Groups:</h6>
                        <p>${survey.groups.join(', ') || 'None'}</p>
                    `;
                }

                // Show the survey detail modal
                const modal = document.getElementById('surveyDetailModal');
                if (modal) {
                    const myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }

                // Store the current survey index for later use
                document.getElementById('surveyDetailModal').dataset.surveyIndex = index;
            }
        }

        // Add event listener for Complete Survey button
        const btnCompleteSurvey = document.getElementById('btnCompleteSurvey');
        if (btnCompleteSurvey) {
            btnCompleteSurvey.addEventListener('click', function() {
                const surveyIndex = document.getElementById('surveyDetailModal').dataset.surveyIndex;
                const surveys = JSON.parse(localStorage.getItem('surveys')) || [];
                const survey = surveys[surveyIndex];
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));

                if (survey && currentUser) {
                    // Get the user's groups
                    const groups = JSON.parse(localStorage.getItem('groups')) || [];
                    const userGroups = groups.filter(group => 
                        group.members.includes(currentUser.email)
                    );

                    if (userGroups.length === 0) {
                        Swal.fire({
                            title: 'Error',
                            text: 'You are not a member of any groups for this survey.',
                            icon: 'error'
                        });
                        return;
                    }

                    // Determine which select element to use based on user role
                    const selectId = currentUser.role === 'Student' ? 'studentGroupMemberSelect' : 'facultyGroupMemberSelect';
                    const groupMemberSelect = document.getElementById(selectId);
                    
                    if (groupMemberSelect) {
                        groupMemberSelect.innerHTML = '<option value="">Choose a group member...</option>';
                        
                        // Get all unique members from user's groups
                        const allMembers = new Set();
                        userGroups.forEach(group => {
                            group.members.forEach(member => allMembers.add(member));
                        });

                        allMembers.forEach(member => {
                            if (member !== currentUser.email) { // Don't include current user
                                const option = document.createElement('option');
                                option.value = member;
                                option.textContent = member;
                                groupMemberSelect.appendChild(option);
                            }
                        });
                    }

                    // Load survey fields
                    const surveyFieldsContainer = document.getElementById('surveyFieldsContainer');
                    if (surveyFieldsContainer) {
                        surveyFieldsContainer.innerHTML = survey.fields;
                    }

                    // Show the complete survey modal
                    const modal = document.getElementById('completeSurveyModal');
                    if (modal) {
                        const myModal = new bootstrap.Modal(modal);
                        myModal.show();
                    }

                    // Close the survey detail modal
                    const detailModal = document.getElementById('surveyDetailModal');
                    if (detailModal) {
                        const detailModalInstance = bootstrap.Modal.getInstance(detailModal);
                        detailModalInstance.hide();
                    }
                }
            });
        }

        // Add event listener for Submit Survey button
        const btnSubmitSurvey = document.getElementById('btnSubmitSurvey');
        if (btnSubmitSurvey) {
            btnSubmitSurvey.addEventListener('click', function() {
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                const selectId = currentUser.role === 'Student' ? 'studentGroupMemberSelect' : 'facultyGroupMemberSelect';
                const groupMemberSelect = document.getElementById(selectId);
                const selectedMember = groupMemberSelect.value;

                if (!selectedMember) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please select a group member',
                        icon: 'error'
                    });
                    return;
                }

                // Collect survey responses
                const form = document.getElementById('surveyResponseForm');
                const formData = new FormData(form);
                const responses = {};

                // Get all form elements
                const formElements = form.elements;
                for (let i = 0; i < formElements.length; i++) {
                    const element = formElements[i];
                    if (element.name && element.type !== 'button') {
                        if (element.type === 'checkbox' || element.type === 'radio') {
                            if (element.checked) {
                                responses[element.name] = element.value;
                            }
                        } else {
                            responses[element.name] = element.value;
                        }
                    }
                }

                // Save the response
                const surveyIndex = document.getElementById('surveyDetailModal').dataset.surveyIndex;
                const surveys = JSON.parse(localStorage.getItem('surveys')) || [];
                const survey = surveys[surveyIndex];

                // Create response object
                const response = {
                    surveyId: surveyIndex,
                    surveyTitle: survey.title,
                    groupMember: selectedMember,
                    responses: responses,
                    submittedBy: JSON.parse(localStorage.getItem('currentUser')).email,
                    submittedAt: new Date().toISOString()
                };

                // Save to localStorage
                let surveyResponses = JSON.parse(localStorage.getItem('surveyResponses')) || [];
                surveyResponses.push(response);
                localStorage.setItem('surveyResponses', JSON.stringify(surveyResponses));

                // Show success message
                Swal.fire({
                    title: 'Success',
                    text: 'Survey response submitted successfully!',
                    icon: 'success'
                });

                // Reset the form
                form.reset();
            });
        }

        // Add event listener for Complete Another button
        const btnCompleteAnother = document.getElementById('btnCompleteAnother');
        if (btnCompleteAnother) {
            btnCompleteAnother.addEventListener('click', function() {
                const form = document.getElementById('surveyResponseForm');
                form.reset();
            });
        }

        // Add New Group Button in Manage Groups Modal
        const btnAddNewGroup = document.getElementById('btnAddNewGroup');
        if (btnAddNewGroup) {
            btnAddNewGroup.addEventListener('click', function() {
                const modal = document.getElementById('addGroupModal');
                const manageGroupsModal = document.getElementById('manageGroupsModal');
                if (modal) {
                    // Add blur class to manage groups modal
                    if (manageGroupsModal) {
                        manageGroupsModal.classList.add('blur-background');
                    }
                    var myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }
            });
        }

        // Save Group Button
        const btnSaveGroup = document.getElementById('btnSaveGroup');
        if (btnSaveGroup) {
            btnSaveGroup.addEventListener('click', function() {
                const groupName = document.getElementById('groupName').value.trim();
                const groupMembers = document.getElementById('groupMembers').value.trim();

                if (!groupName) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please enter a group name',
                        icon: 'error'
                    });
                    return;
                }

                if (!groupMembers) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please enter at least one group member',
                        icon: 'error'
                    });
                    return;
                }

                // Create group object
                const group = {
                    name: groupName,
                    members: groupMembers.split('\n').filter(member => member.trim() !== ''),
                    createdAt: new Date().toISOString()
                };

                // Save group to localStorage
                let groups = JSON.parse(localStorage.getItem('groups')) || [];
                groups.push(group);
                localStorage.setItem('groups', JSON.stringify(groups));

                // Show success message
                Swal.fire({
                    title: 'Success',
                    text: 'Group saved successfully!',
                    icon: 'success'
                });

                // Reset the form and close the modal
                document.getElementById('groupForm').reset();
                const modal = document.getElementById('addGroupModal');
                if (modal) {
                    const myModal = bootstrap.Modal.getInstance(modal);
                    myModal.hide();
                }

                // Refresh the groups list
                const groupsListContainer = document.getElementById('groupsListContainer');
                if (groupsListContainer) {
                    groupsListContainer.innerHTML = ''; // Clear existing content

                    if (groups.length === 0) {
                        groupsListContainer.innerHTML = '<p class="text-center">No groups available.</p>';
                    } else {
                        groups.forEach((group, index) => {
                            const groupItem = document.createElement('div');
                            groupItem.className = 'list-group-item';
                            groupItem.innerHTML = `
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5>${group.name}</h5>
                                        <p><strong>Members:</strong> ${group.members.join(', ')}</p>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-primary" onclick="editGroup(${index})">Edit</button>
                                        <button class="btn btn-danger" onclick="deleteGroup(${index})">Delete</button>
                                    </div>
                                </div>
                            `;
                            groupsListContainer.appendChild(groupItem);
                        });
                    }
                }
            });
        }

        // Delete Group function
        function deleteGroup(index) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Get current groups
                    let groups = JSON.parse(localStorage.getItem('groups')) || [];
                    
                    // Remove the group at the specified index
                    groups.splice(index, 1);
                    
                    // Save updated groups
                    localStorage.setItem('groups', JSON.stringify(groups));
                    
                    // Show success message
                    Swal.fire(
                        'Deleted!',
                        'Your group has been deleted.',
                        'success'
                    );
                    
                    // Refresh the groups list
                    const groupsListContainer = document.getElementById('groupsListContainer');
                    if (groupsListContainer) {
                        groupsListContainer.innerHTML = ''; // Clear existing content
                        
                        if (groups.length === 0) {
                            groupsListContainer.innerHTML = '<p class="text-center">No groups available.</p>';
                        } else {
                            groups.forEach((group, newIndex) => {
                                const groupItem = document.createElement('div');
                                groupItem.className = 'list-group-item';
                                groupItem.innerHTML = `
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5>${group.name}</h5>
                                            <p><strong>Members:</strong> ${group.members.join(', ')}</p>
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-primary" onclick="editGroup(${newIndex})">Edit</button>
                                            <button class="btn btn-danger" onclick="deleteGroup(${newIndex})">Delete</button>
                                        </div>
                                    </div>
                                `;
                                groupsListContainer.appendChild(groupItem);
                            });
                        }
                    }
                }
            });
        }

        // Consolidated Manage Courses functionality
        const btnManageCoursesNav = document.getElementById('btnManageCoursesNav');
        const btnManageCoursesCard = document.getElementById('btnManageCoursesCard');
        const btnAddNewCourse = document.getElementById('btnAddNewCourse');

        function loadCourses() {
            // Check if user is logged in
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                Swal.fire({
                    title: 'Error',
                    text: 'Please login first',
                    icon: 'error'
                });
                return;
            }

            // Load existing courses
            const coursesListContainer = document.getElementById('coursesListContainer');
            if (coursesListContainer) {
                coursesListContainer.innerHTML = ''; // Clear existing content

                // Fetch courses from backend
                fetch('http://localhost:8000/view-courses')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Raw response data:', data);
                        
                        // Check if data is an array or has a courses property
                        let courses = Array.isArray(data) ? data : (data.courses || []);
                        console.log('Processed courses array:', courses);
                        
                        if (courses.length === 0) {
                            coursesListContainer.innerHTML = '<p class="text-center">No courses available.</p>';
                        } else {
                            courses.forEach((course, index) => {
                                console.log('Processing course:', course);
                                const courseItem = document.createElement('div');
                                courseItem.className = 'list-group-item bg-light text-dark';
                                
                                // Format dates
                                const startDate = new Date(course.StartDate).toLocaleDateString();
                                const endDate = new Date(course.EndDate).toLocaleDateString();
                                
                                courseItem.innerHTML = `
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div class="w-100">
                                            <h5 class="mb-3 text-dark">${course.CourseName}</h5>
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <p class="mb-2 text-dark"><strong>Course Number:</strong> ${course.CourseNumber}</p>
                                                    <p class="mb-2 text-dark"><strong>Section:</strong> ${course.CourseSection}</p>
                                                </div>
                                                <div class="col-md-6">
                                                    <p class="mb-2 text-dark"><strong>Term:</strong> ${course.CourseTerm}</p>
                                                    <p class="mb-2 text-dark"><strong>Duration:</strong> ${course.StartDate} - ${course.EndDate}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-flex gap-2 ms-3">
                                            <button class="btn btn-primary" onclick="editCourse(${index})">Edit</button>
                                            <button class="btn btn-danger" onclick="deleteCourse(${index})">Delete</button>
                                        </div>
                                    </div>
                                `;
                                coursesListContainer.appendChild(courseItem);
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching courses:', error);
                        coursesListContainer.innerHTML = '<p class="text-center text-danger">Error loading courses. Please try again.</p>';
                    });
            }

            // Show the manage courses modal
            const manageCoursesModal = document.getElementById('manageCoursesModal');
            if (manageCoursesModal) {
                const myModal = new bootstrap.Modal(manageCoursesModal);
                myModal.show();
            }
        }

        if (btnManageCoursesNav) {
            btnManageCoursesNav.addEventListener('click', loadCourses);
        }

        if (btnManageCoursesCard) {
            btnManageCoursesCard.addEventListener('click', loadCourses);
        }

        if (btnAddNewCourse) {
            btnAddNewCourse.addEventListener('click', function() {
                const modal = document.getElementById('addCourseModal');
                const manageCoursesModal = document.getElementById('manageCoursesModal');
                if (modal) {
                    // Add blur class to manage courses modal
                    if (manageCoursesModal) {
                        manageCoursesModal.classList.add('blur-background');
                    }
                    var myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }
            });
        }

        // Add event listener for Save Course button
        const btnSaveCourse = document.getElementById('btnSaveCourse');
        if (btnSaveCourse) {
            btnSaveCourse.addEventListener('click', function() {
                const courseName = document.getElementById('courseName').value.trim();
                const courseNumber = document.getElementById('courseNumber').value.trim();
                const courseSection = document.getElementById('courseSection').value.trim();
                const courseTerm = document.getElementById('courseTerm').value;
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;

                // Validate all fields
                if (!courseName || !courseNumber || !courseSection || !courseTerm || !startDate || !endDate) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please fill in all required fields',
                        icon: 'error'
                    });
                    return;
                }

                // Validate dates
                const start = new Date(startDate);
                const end = new Date(endDate);
                if (start > end) {
                    Swal.fire({
                        title: 'Error',
                        text: 'End date must be after start date',
                        icon: 'error'
                    });
                    return;
                }

                // Send course data to backend
                fetch('http://localhost:8000/create-course', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        courseName: courseName,
                        courseNumber: courseNumber,
                        courseSection: courseSection,
                        courseTerm: courseTerm,
                        courseStartDate: startDate,
                        courseEndDate: endDate
                    })
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Course added successfully:', data);
                    
                    // Show success message
                    Swal.fire({
                        title: 'Success',
                        text: 'Course saved successfully!',
                        icon: 'success'
                    });

                    // Reset the form and close the modal
                    document.getElementById('courseForm').reset();
                    const modal = document.getElementById('addCourseModal');
                    if (modal) {
                        const myModal = bootstrap.Modal.getInstance(modal);
                        myModal.hide();
                    }

                    // Remove blur from manage courses modal
                    const manageCoursesModal = document.getElementById('manageCoursesModal');
                    if (manageCoursesModal) {
                        manageCoursesModal.classList.remove('blur-background');
                    }

                    // Refresh the courses list
                    loadCourses();
                })
                .catch((error) => {
                    console.error('Error adding course:', error);
                    Swal.fire({
                        title: 'Error',
                        text: 'Failed to save course. Please try again.',
                        icon: 'error'
                    });
                });
            });
        }

        // Add delete course function
        function deleteCourse(index) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Get current courses
                    let courses = JSON.parse(localStorage.getItem('courses')) || [];
                    
                    // Remove the course at the specified index
                    courses.splice(index, 1);
                    
                    // Save updated courses
                    localStorage.setItem('courses', JSON.stringify(courses));
                    
                    // Show success message
                    Swal.fire(
                        'Deleted!',
                        'Your course has been deleted.',
                        'success'
                    );
                    
                    // Refresh the courses list
                    loadCourses();
                }
            });
        }

        // Add edit course function
        function editCourse(index) {
            const courses = JSON.parse(localStorage.getItem('courses')) || [];
            const course = courses[index];

            if (course) {
                // Populate the form
                document.getElementById('courseName').value = course.name;
                document.getElementById('courseNumber').value = course.number;
                document.getElementById('courseSection').value = course.section;
                document.getElementById('courseTerm').value = course.term;
                document.getElementById('startDate').value = course.startDate;
                document.getElementById('endDate').value = course.endDate;

                // Show the modal
                const modal = document.getElementById('addCourseModal');
                if (modal) {
                    const myModal = new bootstrap.Modal(modal);
                    myModal.show();
                }

                // Update the save button to handle editing
                const btnSaveCourse = document.getElementById('btnSaveCourse');
                if (btnSaveCourse) {
                    btnSaveCourse.onclick = function() {
                        const courseName = document.getElementById('courseName').value.trim();
                        const courseNumber = document.getElementById('courseNumber').value.trim();
                        const courseSection = document.getElementById('courseSection').value.trim();
                        const courseTerm = document.getElementById('courseTerm').value;
                        const startDate = document.getElementById('startDate').value;
                        const endDate = document.getElementById('endDate').value;

                        // Validate all fields
                        if (!courseName || !courseNumber || !courseSection || !courseTerm || !startDate || !endDate) {
                            Swal.fire({
                                title: 'Error',
                                text: 'Please fill in all required fields',
                                icon: 'error'
                            });
                            return;
                        }

                        // Validate dates
                        const start = new Date(startDate);
                        const end = new Date(endDate);
                        if (start > end) {
                            Swal.fire({
                                title: 'Error',
                                text: 'End date must be after start date',
                                icon: 'error'
                            });
                            return;
                        }

                        // Update course object
                        courses[index] = {
                            ...course,
                            name: courseName,
                            number: courseNumber,
                            section: courseSection,
                            term: courseTerm,
                            startDate: startDate,
                            endDate: endDate
                        };

                        // Save updated courses
                        localStorage.setItem('courses', JSON.stringify(courses));

                        // Show success message
                        Swal.fire({
                            title: 'Success',
                            text: 'Course updated successfully!',
                            icon: 'success'
                        });

                        // Reset the form and close the modal
                        document.getElementById('courseForm').reset();
                        const modal = document.getElementById('addCourseModal');
                        if (modal) {
                            const myModal = bootstrap.Modal.getInstance(modal);
                            myModal.hide();
                        }

                        // Refresh the courses list
                        loadCourses();
                    };
                }
            }
        }

        // Add event listener for when the Manage Courses modal is hidden
        const manageCoursesModal = document.getElementById('manageCoursesModal');
        if (manageCoursesModal) {
            manageCoursesModal.addEventListener('hidden.bs.modal', function () {
                // Remove blur from any modals that might have it
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    modal.classList.remove('blur-background');
                });
            });
        }

        // Add event listener for when the Add Course modal is hidden
        const addCourseModal = document.getElementById('addCourseModal');
        if (addCourseModal) {
            addCourseModal.addEventListener('hidden.bs.modal', function () {
                // Remove blur from manage courses modal
                const manageCoursesModal = document.getElementById('manageCoursesModal');
                if (manageCoursesModal) {
                    manageCoursesModal.classList.remove('blur-background');
                }
            });
        }
        
    

        // Profile Button Click Handler
        const profileLinks = document.querySelectorAll('.dropdown-item[href="#"]');
        profileLinks.forEach(profileLink => {
            profileLink.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Profile link clicked');
                
                // Get current user
                const currentUser = JSON.parse(localStorage.getItem('currentUser'));
                if (!currentUser) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Please login first',
                        icon: 'error'
                    });
                    return;
                }

                // Fetch profile data from backend
                fetch(`http://localhost:8000/profile?email=${currentUser.email}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            // Update profile information
                            document.getElementById('profileName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
                            document.getElementById('profileEmail').textContent = currentUser.email;
                            document.getElementById('profileDepartment').textContent = data.profile.department || 'Not specified';
                            document.getElementById('profileClasses').textContent = data.profile.classesTeaching || '0';

                            // Update teaching schedule
                            const teachingSchedule = document.getElementById('teachingSchedule');
                            if (data.profile.teachingSchedule && data.profile.teachingSchedule.length > 0) {
                                teachingSchedule.innerHTML = data.profile.teachingSchedule.map(course => `
                                    <div class="teaching-schedule-item">
                                        <h6>${course.name}</h6>
                                        <p class="mb-1"><strong>Time:</strong> ${course.time}</p>
                                        <p class="mb-1"><strong>Days:</strong> ${course.days.join(', ')}</p>
                                        <p class="mb-0"><strong>Location:</strong> ${course.location}</p>
                                    </div>
                                `).join('');
                            } else {
                                teachingSchedule.innerHTML = '<p class="text-muted">No teaching schedule available.</p>';
                            }

                            // Generate schedule table
                            const scheduleTable = document.getElementById('scheduleTable');
                            scheduleTable.innerHTML = ''; // Clear existing content

                            // Create time slots (8 AM to 5 PM)
                            for (let hour = 8; hour <= 17; hour++) {
                                const row = document.createElement('tr');
                                const timeCell = document.createElement('td');
                                timeCell.textContent = `${hour}:00`;
                                row.appendChild(timeCell);

                                // Add cells for each day
                                for (let day = 0; day < 5; day++) {
                                    const cell = document.createElement('td');
                                    cell.className = 'schedule-cell';
                                    
                                    // Check if this time slot has a class
                                    const hasClass = data.profile.teachingSchedule?.some(course => {
                                        const courseTime = parseInt(course.time.split(':')[0]);
                                        const courseDays = course.days;
                                        const currentDay = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'][day];
                                        return courseTime === hour && courseDays.includes(currentDay);
                                    });

                                    // Check if this is office hours (example: 2-4 PM on Monday and Wednesday)
                                    const isOfficeHour = (hour >= 14 && hour < 16) && (day === 0 || day === 2);

                                    if (hasClass) {
                                        cell.className += ' teaching-hour';
                                        const course = data.profile.teachingSchedule.find(c => 
                                            parseInt(c.time.split(':')[0]) === hour && 
                                            c.days.includes(['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'][day])
                                        );
                                        cell.innerHTML = `<strong>${course.name}</strong><br>${course.location}`;
                                    } else if (isOfficeHour) {
                                        cell.className += ' office-hour';
                                        cell.innerHTML = '<strong>Office Hours</strong>';
                                    } else {
                                        cell.className += ' available-hour';
                                        cell.innerHTML = 'Available';
                                    }

                                    row.appendChild(cell);
                                }

                                scheduleTable.appendChild(row);
                            }

                            // Show the modal
                            const profileModal = document.getElementById('profileModal');
                            if (profileModal) {
                                const modal = new bootstrap.Modal(profileModal);
                                modal.show();
                            }
                        } else {
                            Swal.fire({
                                title: 'Error',
                                text: 'Failed to load profile data',
                                icon: 'error'
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching profile:', error);
                        Swal.fire({
                            title: 'Error',
                            text: 'Failed to load profile data',
                            icon: 'error'
                        });
                    });
            });
        });

        // Logout functionality
        document.querySelectorAll('.logout-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                // Clear localStorage
                localStorage.removeItem('currentUser');
                // Show login form
                document.getElementById('loginForm').style.display = 'block';
                // Hide all other forms
                document.getElementById('registerForm').style.display = 'none';
                document.getElementById('frmFacultyDash').style.display = 'none';
                document.getElementById('frmStudentDash').style.display = 'none';
                // Scroll to login form
                document.getElementById('loginForm').scrollIntoView({ behavior: 'smooth' });
            });
        });
    });

    // Login handler
    function handleLogin(e) {
        e.preventDefault();
        
        const strEmail = document.querySelector("#strUsername").value.trim();
        const strPassword = document.querySelector("#strPassword").value.trim();

        const regEmail = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/i;
        const regPassword = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
        let blnError = false;
        let strMessage = "";

        if (!regEmail.test(strEmail)) {
            blnError = true;
            strMessage += "<p>Please enter a valid email address.</p>";
        } 
        if (!regPassword.test(strPassword)) {
            blnError = true;
            strMessage += "<p>Please enter a valid password.</p>";
        }

        if (blnError) {
            Swal.fire({
                title: "Error",
                html: strMessage,
                icon: "error",
            });
        } else {
            // Send login data to backend
            fetch('http://localhost:8000/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: strEmail,
                    password: strPassword
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    // Store user data in localStorage
                    const userData = {
                        email: strEmail,
                        firstName: data.user.FirstName,
                        lastName: data.user.LastName,
                        role: data.user.UserRole,
                        createdAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem('currentUser', JSON.stringify(userData));
                    
                    Swal.fire({
                        title: "Success!",
                        text: `Login successful! Redirecting to ${data.user.UserRole.toLowerCase()} dashboard...`,
                        icon: "success",
                        timer: 1500,
                        showConfirmButton: false
                    }).then(() => {
                        const bgImage = document.getElementById("bgImage");
                        if (bgImage) bgImage.style.display = "none";
                        
                        if (data.user.UserRole === 'Student') {
                            const studentDash = document.getElementById("frmStudentDash");
                            const loginForm = document.getElementById("frmLogin");
                            if (studentDash) studentDash.style.display = "block";
                            if (loginForm) loginForm.style.display = "none";
                        } else {
                            const facultyDash = document.getElementById("frmFacultyDash");
                            const loginForm = document.getElementById("frmLogin");
                            if (facultyDash) facultyDash.style.display = "block";
                            if (loginForm) loginForm.style.display = "none";
                        }
                    });
                } else {
                    Swal.fire({
                        title: "Login Error",
                        text: data.message || "Invalid email or password",
                        icon: "error"
                    });
                }
            })
            .catch(error => {
                console.error("Error during login:", error);
                Swal.fire({
                    title: "Error",
                    text: "Failed to connect to the server. Please try again.",
                    icon: "error"
                });
            });
        }
    }

    // Registration handler
    function handleRegister(e) {
        e.preventDefault();
        
        const regEmail = /^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$/i;
        const regPass = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
        const role = document.getElementById("strRole").value;

        let email = document.querySelector("#strEmail").value.trim();
        let password = document.querySelector("#strNewPassword").value.trim();
        let confirmPassword = document.querySelector("#strConfirmPassword").value.trim();
        let firstName = document.querySelector("#strFirstName").value.trim();
        let lastName = document.querySelector("#strLastName").value.trim();
        let middleName = document.querySelector("#strMiddleName").value.trim();
        
        let errors = "";

        // Required Field Validation
        if (!firstName) errors += "<p class='mb-1 mt-1'>First Name is required</p>";
        if (!lastName) errors += "<p class='mb-1 mt-1'>Last Name is required</p>";    

        // Email Validation
        if (!regEmail.test(email)) {
            errors += "<p class='mb-1 mt-1'>Invalid email format</p>";
        }

        // Password Validation
        if (!regPass.test(password)) {
            errors += "<p class='mb-1 mt-1'>Password must be at least 8 characters, contain one uppercase letter, one lowercase letter, and one number</p>";
        }

        if (password !== confirmPassword) {
            errors += "<p class='mb-1 mt-1'>Passwords do not match</p>";
        }
        console.log(role)

        if (errors) {
            Swal.fire({
                title: "Registration Error!",
                html: errors,
                icon: "error"
            });
        } else {
            // Create the registration data object
            const registrationData = {
                firstName,
                middleName,
                lastName,
                email,
                password,
                role
            };

            // Send registration data to backend
            fetch('http://localhost:8000/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(registrationData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    // Store user data in localStorage
                    const userData = {
                        firstName,
                        middleName,
                        lastName,
                        email,
                        role,
                        createdAt: new Date().toISOString()
                    };
                    
                    console.log(userData)
                    localStorage.setItem('currentUser', JSON.stringify(userData));
                    
                    if(role === 'Student'){
                        Swal.fire({
                            icon: "success",
                            title: "Registration Successful",
                            text: "Sending student to the student dashboard"
                        }).then(()=>{
                            const studentDash = document.getElementById("frmStudentDash");
                            const registerForm = document.getElementById("frmRegister");
                            const loginForm = document.getElementById("frmLogin");
                            
                            if (studentDash) {
                                studentDash.style.display = "block";
                                studentDash.scrollIntoView({ behavior: 'instant' });
                            }
                            if (registerForm) registerForm.style.display = "none";
                            if (loginForm) loginForm.style.display = "none";
                            // Scroll to the top of the page
                            window.scrollTo(0, 0);
                        });
                    } else if(role === 'Faculty'){
                        Swal.fire({
                            icon: "success",
                            title: "Registration Successful",
                            text: "Sending faculty to the faculty dashboard"
                        }).then(()=>{
                            const facultyDash = document.getElementById("frmFacultyDash");
                            const registerForm = document.getElementById("frmRegister");
                            const loginForm = document.getElementById("frmLogin");
                            
                            if (facultyDash) {
                                facultyDash.style.display = "block";
                                facultyDash.scrollIntoView({ behavior: 'instant' });
                            }
                            if (registerForm) registerForm.style.display = "none";
                            if (loginForm) loginForm.style.display = "none";
                            // Scroll to the top of the page
                            window.scrollTo(0, 0);
                        });
                    }
                } else {
                    let errorMessage = data.message || 'Registration failed';
                    if (errorMessage.includes('already registered')) {
                        Swal.fire({
                            icon: 'warning',
                            title: 'Account Exists',
                            text: 'This email address is already registered. Please use a different email or try logging in.',
                            confirmButtonText: 'Go to Login',
                            showCancelButton: true,
                            cancelButtonText: 'Try Again'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                document.getElementById('registerForm').style.display = 'none';
                                document.getElementById('loginForm').style.display = 'block';
                            }
                        });
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: errorMessage
                        });
                    }
                }
            })
            .catch(error => {
                console.error("Error during registration:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Registration Error',
                    text: 'Failed to connect to the server. Please try again.',
                    confirmButtonText: 'Try Again'
                });
            });
        }
    }

    // Logout function
    function logout() {
        Swal.fire({
            title: 'Are you sure you want to logout?',
            text: "You will now be redirected to login page",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Yes, Logout Please!',
            cancelButtonText: "No, Don't leave",
        }).then((result)=> {
            if (result.isConfirmed){
                try {
                    localStorage.removeItem('currentUser');
                    
                    const studentDash = document.getElementById("frmStudentDash");
                    const loginForm = document.getElementById("frmLogin");
                    const facultyDash = document.getElementById("frmFacultyDash");
                    
                    if (studentDash) studentDash.style.display = "none";
                    if (loginForm) loginForm.style.display = "block";
                    if (facultyDash) facultyDash.style.display = "none";
                    // Scroll to the top of the page
                    window.scrollTo(0, 0);
                } catch (error) {
                    console.error("Error during logout:", error);
                    Swal.fire({
                        title: "Error",
                        text: "Failed to logout. Please try again.",
                        icon: "error"
                    });
                }
            } else {
                Swal.fire({
                    title: 'Logout Cancelled',
                    text: 'You are still logged in',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            }
        });
    }
</script>
</html>

